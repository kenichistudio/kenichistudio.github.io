---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar.astro";
import CtaSection from "../../components/CtaSection.astro";
import { ChevronLeft } from "lucide-react";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
        params: { slug: post.slug },
        props: post,
    }));
}

const post = Astro.props;
const { Content } = await post.render();
---

<Layout title={`${post.data.title} - Kinetix Blog`}>
    <Navbar />
    <main class="min-h-screen bg-white pt-24 pb-24 overflow-x-hidden">
        {
            /* Progress Bar (Optional, simpler implementation later potentially) */
        }

        <article>
            {/* Hero Header */}
            <div class="container mx-auto px-6 max-w-4xl mb-12 md:mb-20">
                {/* Back Link */}
                <a
                    href={`${import.meta.env.BASE_URL}blog`}
                    class="inline-flex items-center text-slate-500 hover:text-blue-600 mb-8 transition-colors text-sm font-bold uppercase tracking-wider group"
                >
                    <ChevronLeft
                        size={16}
                        className="mr-1 group-hover:-translate-x-1 transition-transform"
                    />
                    Back to Blog
                </a>

                {/* Tags */}
                <div class="flex flex-wrap gap-2 mb-6">
                    {
                        post.data.tags?.map((tag) => (
                            <span class="text-xs font-bold px-3 py-1 bg-blue-50 text-blue-600 rounded-full uppercase tracking-wider">
                                {tag}
                            </span>
                        ))
                    }
                </div>

                {/* Title */}
                <h1
                    class="text-4xl md:text-6xl font-bold text-slate-900 mb-8 leading-tight font-display tracking-tight"
                >
                    {post.data.title}
                </h1>

                {/* Meta */}
                <div class="flex items-center gap-4 text-slate-500 text-sm">
                    <div class="flex items-center gap-3">
                        {/* Author Avatar Placeholder */}
                        <div
                            class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-xs shadow-md"
                        >
                            {post.data.author.charAt(0)}
                        </div>
                        <div>
                            <div class="font-bold text-slate-900">
                                {post.data.author}
                            </div>
                            <div class="text-xs">
                                {
                                    post.data.pubDate.toLocaleDateString(
                                        "en-US",
                                        {
                                            year: "numeric",
                                            month: "long",
                                            day: "numeric",
                                        },
                                    )
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {/* Featured Image - Wide */}
            {
                post.data.image && (
                    <div class="container mx-auto px-0 md:px-6 max-w-6xl mb-16 md:mb-24">
                        <div class="aspect-video md:rounded-[2.5rem] overflow-hidden shadow-2xl">
                            <img
                                src={post.data.image}
                                alt={post.data.title}
                                class="w-full h-full object-cover"
                            />
                        </div>
                    </div>
                )
            }

            {/* Content Content - Centered & Prosed */}
            <div class="container mx-auto px-6 max-w-3xl">
                <div
                    class="prose prose-lg md:prose-xl prose-slate prose-headings:font-display prose-headings:font-bold prose-headings:tracking-tight prose-a:text-blue-600 prose-img:rounded-2xl prose-img:shadow-lg prose-pre:overflow-x-auto prose-pre:bg-slate-900 prose-pre:border prose-pre:border-slate-800 max-w-none"
                >
                    <Content />
                </div>
            </div>
        </article>

        {/* Divider */}
        <div class="container mx-auto px-6 max-w-4xl mt-24">
            <hr class="border-slate-200" />
        </div>

        <CtaSection />
    </main>
</Layout>

<style is:global>
    /* Custom Scrollbar for code blocks */
    pre::-webkit-scrollbar {
        height: 8px;
    }
    pre::-webkit-scrollbar-track {
        background: #1e293b;
        border-radius: 4px;
    }
    pre::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 4px;
    }
    pre::-webkit-scrollbar-thumb:hover {
        background: #64748b;
    }

    .font-display {
        font-family: "Outfit", sans-serif;
    }
</style>
